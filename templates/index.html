<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR Text Extractor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #0f172a; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        @keyframes modalFadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes modalSlideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-overlay { animation: modalFadeIn 0.3s ease-out; }
        .modal-content { animation: modalSlideIn 0.3s ease-out; }
        body.modal-open { overflow: hidden; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-gray-100">
    <div class="container mx-auto px-3 sm:px-4 md:px-6 py-4 sm:py-6 md:py-8 max-w-7xl">
        <div class="text-center mb-6 sm:mb-8 md:mb-12">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent mb-2">OCR Text Extractor</h1>
            <p class="text-gray-400 text-sm sm:text-base md:text-lg px-4">AI-powered text extraction from images</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-5 md:gap-6">
            <div class="bg-slate-800/50 backdrop-blur-lg border border-slate-700 rounded-xl sm:rounded-2xl p-4 sm:p-5 md:p-6 shadow-2xl">
                <div class="flex items-center gap-2 sm:gap-3 mb-4 sm:mb-5 md:mb-6">
                    <i class="fas fa-cloud-upload text-xl sm:text-2xl text-cyan-400"></i>
                    <h2 class="text-xl sm:text-2xl font-bold">Upload Image</h2>
                </div>
                
                <div id="uploadArea" class="border-2 sm:border-3 border-dashed border-slate-600 hover:border-cyan-500 active:border-cyan-400 transition-colors rounded-lg sm:rounded-xl p-6 sm:p-8 md:p-12 text-center cursor-pointer mb-4 sm:mb-5 md:mb-6 bg-slate-900/50 touch-manipulation">
                    <input type="file" id="imageInput" accept="image/*" class="hidden">
                    <div id="uploadContent">
                        <i class="fas fa-image text-4xl sm:text-5xl md:text-6xl text-cyan-400 mb-3 sm:mb-4 opacity-70"></i>
                        <p class="text-base sm:text-lg font-semibold mb-1 sm:mb-2">Click or drag image here</p>
                        <p class="text-xs sm:text-sm text-gray-500">PNG, JPG, JPEG (Max 16MB)</p>
                    </div>
                    <div id="previewContent" class="hidden">
                        <img id="previewImage" class="max-w-full max-h-48 sm:max-h-56 md:max-h-64 mx-auto rounded-lg shadow-xl mb-3 sm:mb-4">
                        <p id="fileName" class="text-sm sm:text-base text-gray-300 font-medium truncate px-2"></p>
                    </div>
                </div>

                <button id="processBtn" disabled class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 active:scale-95 disabled:from-slate-700 disabled:to-slate-700 text-white font-bold py-3 sm:py-4 rounded-lg sm:rounded-xl transition-all shadow-lg disabled:cursor-not-allowed text-sm sm:text-base touch-manipulation">
                    <i class="fas fa-wand-magic-sparkles mr-2"></i>Extract Text
                </button>

                <div id="loading" class="hidden text-center mt-4 sm:mt-5 md:mt-6">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 border-4 border-slate-700 border-t-cyan-500 rounded-full animate-spin mx-auto mb-2 sm:mb-3"></div>
                    <p class="font-semibold text-gray-400 text-sm sm:text-base">Processing image...</p>
                </div>
            </div>

            <div class="bg-slate-800/50 backdrop-blur-lg border border-slate-700 rounded-xl sm:rounded-2xl p-4 sm:p-5 md:p-6 shadow-2xl">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0 mb-4 sm:mb-5 md:mb-6">
                    <div class="flex items-center gap-2 sm:gap-3">
                        <i class="fas fa-list-check text-xl sm:text-2xl text-cyan-400"></i>
                        <h2 class="text-xl sm:text-2xl font-bold">Extracted Text</h2>
                    </div>
                    <div class="flex items-center gap-2">
                        <span id="resultCount" class="hidden bg-cyan-500/20 text-cyan-400 text-xs sm:text-sm font-bold px-3 py-1 rounded-full"></span>
                        <button id="expandResultsBtn" class="hidden bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded-lg transition-all text-xs sm:text-sm touch-manipulation">
                            <i class="fas fa-expand mr-1"></i>Expand
                        </button>
                    </div>
                </div>
                
                <div id="resultsContainer" class="space-y-2 sm:space-y-3 max-h-[400px] sm:max-h-[450px] md:max-h-[500px] overflow-y-auto pr-1 sm:pr-2 scrollbar-thin">
                    <div class="text-center py-12 sm:py-16 md:py-20 text-gray-500">
                        <i class="fas fa-file-text text-4xl sm:text-5xl md:text-6xl mb-3 sm:mb-4 opacity-30"></i>
                        <p class="text-sm sm:text-base md:text-lg px-4">Upload an image to extract text</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="outputSection" class="hidden mt-4 sm:mt-5 md:mt-6 bg-slate-800/50 backdrop-blur-lg border border-slate-700 rounded-xl sm:rounded-2xl p-4 sm:p-5 md:p-6 shadow-2xl">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0 mb-4 sm:mb-5 md:mb-6">
                <div class="flex items-center gap-2 sm:gap-3">
                    <i class="fas fa-image text-xl sm:text-2xl text-cyan-400"></i>
                    <h2 class="text-xl sm:text-2xl font-bold">Processed Image</h2>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
                    <button id="expandImageBtn" class="bg-slate-700 hover:bg-slate-600 text-white px-4 sm:px-6 py-2.5 sm:py-2 rounded-lg transition-all shadow-lg font-semibold text-sm sm:text-base touch-manipulation">
                        <i class="fas fa-expand mr-2"></i>View Fullscreen
                    </button>
                    <button id="downloadBtn" class="bg-emerald-500 hover:bg-emerald-600 active:scale-95 text-white px-4 sm:px-6 py-2.5 sm:py-2 rounded-lg transition-all shadow-lg font-semibold text-sm sm:text-base touch-manipulation">
                        <i class="fas fa-download mr-2"></i>Download JSON
                    </button>
                </div>
            </div>
            <div class="bg-slate-900/50 rounded-lg sm:rounded-xl p-3 sm:p-4 border border-slate-700 overflow-x-auto">
                <img id="outputImage" class="max-w-full mx-auto rounded-lg shadow-2xl cursor-pointer hover:opacity-90 transition-opacity" alt="Processed OCR Image">
            </div>
        </div>
    </div>

    <div id="resultsModal" class="hidden fixed inset-0 z-50 modal-overlay">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm"></div>
        <div class="relative h-full flex items-center justify-center p-4">
            <div class="modal-content bg-slate-800 rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] border border-slate-700 flex flex-col">
                <div class="flex items-center justify-between p-4 sm:p-6 border-b border-slate-700">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-list-check text-2xl sm:text-3xl text-cyan-400"></i>
                        <div>
                            <h3 class="text-xl sm:text-2xl font-bold">Extracted Text Results</h3>
                            <p class="text-xs sm:text-sm text-gray-400 mt-1" id="modalResultCount"></p>
                        </div>
                    </div>
                    <button id="closeResultsModal" class="text-gray-400 hover:text-white transition-colors p-2 hover:bg-slate-700 rounded-lg">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <div id="modalResultsContainer" class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-3 sm:space-y-4 scrollbar-thin"></div>
                <div class="p-4 sm:p-6 border-t border-slate-700 flex flex-col sm:flex-row gap-3 sm:gap-4">
                    <button id="modalDownloadBtn" class="flex-1 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 rounded-lg transition-all shadow-lg touch-manipulation">
                        <i class="fas fa-download mr-2"></i>Download JSON
                    </button>
                    <button id="copyAllTextBtn" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg transition-all shadow-lg touch-manipulation">
                        <i class="fas fa-copy mr-2"></i>Copy All Text
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="imageModal" class="hidden fixed inset-0 z-50 modal-overlay">
        <div class="absolute inset-0 bg-black/95 backdrop-blur-sm"></div>
        <div class="relative h-full flex items-center justify-center p-4">
            <div class="modal-content bg-slate-800 rounded-2xl shadow-2xl w-full max-w-7xl max-h-[95vh] border border-slate-700 flex flex-col">
                <div class="flex items-center justify-between p-4 sm:p-6 border-b border-slate-700">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-image text-2xl sm:text-3xl text-cyan-400"></i>
                        <h3 class="text-xl sm:text-2xl font-bold">Processed Image</h3>
                    </div>
                    <button id="closeImageModal" class="text-gray-400 hover:text-white transition-colors p-2 hover:bg-slate-700 rounded-lg">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-auto p-4 sm:p-6 bg-slate-900/50 scrollbar-thin">
                    <img id="modalImage" class="max-w-full h-auto mx-auto rounded-lg shadow-2xl" alt="Full Screen Processed Image">
                </div>
                <div class="p-4 sm:p-6 border-t border-slate-700">
                    <button id="modalImageDownloadBtn" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 rounded-lg transition-all shadow-lg touch-manipulation">
                        <i class="fas fa-download mr-2"></i>Download Image
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const $ = id => document.getElementById(id);
        const uploadArea = $('uploadArea');
        const imageInput = $('imageInput');
        const processBtn = $('processBtn');
        const loading = $('loading');
        const resultsContainer = $('resultsContainer');
        const outputSection = $('outputSection');
        const outputImage = $('outputImage');
        const uploadContent = $('uploadContent');
        const previewContent = $('previewContent');
        const previewImage = $('previewImage');
        const fileName = $('fileName');
        const resultCount = $('resultCount');
        const expandResultsBtn = $('expandResultsBtn');
        const expandImageBtn = $('expandImageBtn');
        const resultsModal = $('resultsModal');
        const imageModal = $('imageModal');
        const closeResultsModal = $('closeResultsModal');
        const closeImageModal = $('closeImageModal');
        const modalResultsContainer = $('modalResultsContainer');
        const modalResultCount = $('modalResultCount');
        const modalImage = $('modalImage');

        let currentResults = [];

        uploadArea.addEventListener('click', () => imageInput.click());
        uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('border-cyan-400'); });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('border-cyan-400'));
        uploadArea.addEventListener('drop', e => {
            e.preventDefault();
            uploadArea.classList.remove('border-cyan-400');
            const file = e.dataTransfer.files[0];
            if (file?.type.startsWith('image/')) {
                imageInput.files = e.dataTransfer.files;
                handleImageSelect();
            }
        });

        imageInput.addEventListener('change', handleImageSelect);

        function handleImageSelect() {
            const file = imageInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => {
                    previewImage.src = e.target.result;
                    fileName.textContent = file.name;
                    uploadContent.classList.add('hidden');
                    previewContent.classList.remove('hidden');
                    processBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            }
        }

        processBtn.addEventListener('click', async () => {
            const file = imageInput.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('image', file);

            processBtn.disabled = true;
            loading.classList.remove('hidden');
            resultsContainer.innerHTML = '<div class="text-center py-12 sm:py-16 md:py-20"><i class="fas fa-spinner fa-spin text-3xl sm:text-4xl text-cyan-400 mb-2 sm:mb-3"></i><p class="text-gray-400 text-sm sm:text-base">Processing...</p></div>';
            outputSection.classList.add('hidden');
            expandResultsBtn.classList.add('hidden');

            try {
                const response = await fetch('/process', { method: 'POST', body: formData });
                const data = await response.json();

                if (data.success) {
                    currentResults = data.results;
                    displayResults(data.results);
                    outputImage.src = modalImage.src = data.image;
                    outputSection.classList.remove('hidden');
                    resultCount.textContent = `${data.count} items`;
                    resultCount.classList.remove('hidden');
                    expandResultsBtn.classList.remove('hidden');
                } else {
                    showError(data.error || 'Processing failed');
                }
            } catch (error) {
                showError('Network error. Please try again.');
            } finally {
                loading.classList.add('hidden');
                processBtn.disabled = false;
            }
        });

        function displayResults(results) {
            const html = results.length === 0 
                ? '<div class="text-center py-12 sm:py-16 md:py-20 text-gray-500"><i class="fas fa-circle-exclamation text-3xl sm:text-4xl mb-2 sm:mb-3"></i><p class="text-sm sm:text-base">No text detected</p></div>'
                : results.map(item => `
                    <div class="bg-slate-900/50 hover:bg-slate-900/70 p-3 sm:p-4 rounded-lg border border-slate-700 hover:border-cyan-500 transition-all">
                        <div class="flex flex-col sm:flex-row items-start justify-between gap-3 sm:gap-4">
                            <div class="flex-1 w-full sm:w-auto">
                                <span class="bg-cyan-500/20 text-cyan-400 text-xs font-bold px-2 py-1 rounded">${item.id.toUpperCase()}</span>
                                <p class="text-gray-200 font-medium mt-2 break-words text-sm sm:text-base">${escapeHtml(item.text)}</p>
                                <div class="mt-2 text-xs text-gray-500 flex items-center gap-2 flex-wrap">
                                    <i class="fas fa-location-dot"></i>
                                    <span class="break-all">x:${item.bbox.x} y:${item.bbox.y} w:${item.bbox.width} h:${item.bbox.height}</span>
                                </div>
                            </div>
                            <div class="text-left sm:text-right w-full sm:w-auto">
                                <div class="text-xs text-gray-500">Confidence</div>
                                <div class="text-lg sm:text-xl font-bold text-emerald-400">${(item.confidence * 100).toFixed(0)}%</div>
                            </div>
                        </div>
                    </div>
                `).join('');

            resultsContainer.innerHTML = modalResultsContainer.innerHTML = html;
            modalResultCount.textContent = `${results.length} text items detected`;
        }

        const toggleModal = (modal, show) => {
            modal.classList.toggle('hidden', !show);
            document.body.classList.toggle('modal-open', show);
        };

        expandResultsBtn.addEventListener('click', () => toggleModal(resultsModal, true));
        expandImageBtn.addEventListener('click', () => toggleModal(imageModal, true));
        outputImage.addEventListener('click', () => toggleModal(imageModal, true));
        closeResultsModal.addEventListener('click', () => toggleModal(resultsModal, false));
        closeImageModal.addEventListener('click', () => toggleModal(imageModal, false));

        [resultsModal, imageModal].forEach(modal => {
            modal.addEventListener('click', e => {
                if (e.target === modal) toggleModal(modal, false);
            });
        });

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                toggleModal(resultsModal, false);
                toggleModal(imageModal, false);
            }
        });

        const downloadJSON = () => {
            const blob = new Blob([JSON.stringify(currentResults, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'ocr_results.json';
            link.click();
            URL.revokeObjectURL(url);
        };

        $('downloadBtn').addEventListener('click', downloadJSON);
        $('modalDownloadBtn').addEventListener('click', downloadJSON);

        $('copyAllTextBtn').addEventListener('click', () => {
            const allText = currentResults.map(item => item.text).join('\n');
            navigator.clipboard.writeText(allText).then(() => {
                const btn = $('copyAllTextBtn');
                const original = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check mr-2"></i>Copied!';
                btn.classList.replace('bg-blue-500', 'bg-green-500');
                btn.classList.remove('hover:bg-blue-600');
                setTimeout(() => {
                    btn.innerHTML = original;
                    btn.classList.replace('bg-green-500', 'bg-blue-500');
                    btn.classList.add('hover:bg-blue-600');
                }, 2000);
            });
        });

        $('modalImageDownloadBtn').addEventListener('click', () => {
            const link = document.createElement('a');
            link.href = outputImage.src;
            link.download = 'processed_ocr_image.png';
            link.click();
        });

        function showError(message) {
            resultsContainer.innerHTML = `
                <div class="text-center py-12 sm:py-16 md:py-20 text-red-400">
                    <i class="fas fa-triangle-exclamation text-3xl sm:text-4xl mb-2 sm:mb-3"></i>
                    <p class="font-semibold text-sm sm:text-base px-4">${message}</p>
                </div>`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>